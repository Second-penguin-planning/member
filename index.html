function doPost(e) {
  try {
    var params = JSON.parse(e.postData.contents);
    var ss = SpreadsheetApp.getActiveSpreadsheet();
    
    // ここでシート名を指定しています。スプレッドシートのタブ名と一致させる必要があります。
    var sheet = ss.getSheetByName('Sheet1'); 
    
    if (!sheet) {
      throw new Error("シート 'Sheet1' が見つかりません。タブ名を確認してください。");
    }

    sheet.appendRow([params.category, params.title, params.content]);
    
    return ContentService.createTextOutput("Success")
      .setMimeType(ContentService.MimeType.TEXT);

  } catch (f) {
    // エラーが起きた場合、その内容を返却するようにします
    return ContentService.createTextOutput("Error: " + f.message)
      .setMimeType(ContentService.MimeType.TEXT);
  }
}

function doGet() {
  var ss = SpreadsheetApp.getActiveSpreadsheet();
  var sheet = ss.getSheetByName('Sheet1');
  if (!sheet) return ContentService.createTextOutput(JSON.stringify([])).setMimeType(ContentService.MimeType.JSON);
  
  var values = sheet.getDataRange().getValues();
  if (values.length <= 1) return ContentService.createTextOutput(JSON.stringify([])).setMimeType(ContentService.MimeType.JSON);
  
  values.shift(); 
  var data = values.map(function(row) {
    return { category: row[0], title: row[1], content: row[2] };
  });
  return ContentService.createTextOutput(JSON.stringify(data)).setMimeType(ContentService.MimeType.JSON);
}
